@inject SignInManager<Users> SignInManager
@using Microsoft.AspNetCore.Identity
<div class="row pt-4">
    <div class="col-md-4">

        @if (lastVisited != null)
        {
            <div class="card-group">
                <div class="card">
                    <h2 class="card-header" style="text-align: center;">Ultimos visitados</h2>
                    @foreach (var item in lastVisited)
                    {
                        <div class="card" style="width: 30rem; margin:1rem">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-shop-window m-4" style="font-size:2rem;"></i>@item.Business.Name</h5>
                                <p class="card-text">@item.Business.Address?.Street @item.Business.Address?.Number</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }


    </div>
    <div class="col-md-4">
        <div class="card-group">
            <div class="card">
                <h1>Mis favoritos</h1>
                <table class="table table-striped">
                    <tbody id="order-list-container">
                        @if (favoriteBusinesses != null)
                        {

                            @foreach (var business in favoriteBusinesses)
                            {
                            <td>@business.Business.Name</td>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card-group">
            <div class="card">
                <h1>Recomendados</h1>
                <table class="table table-striped">
                    <tbody id="order-list-container">
                        @if (suggestedBusinesses != null)
                        {
                            @foreach (var business in suggestedBusinesses)
                            {
                            <td>@business.Name</td>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
<div class="row pt-4">

    <h1>Mis productos favoritos</h1>
    @if (favoriteProducts != null)
    {
        @foreach (var item in favoriteProducts)
        {


            <div class="card" style="width: 10rem; margin:1rem">
                <img src="@item.Product.URLImage" class="card-img-top" alt="@item.Product.Name">
                <div class="card-body">
                    <h5 class="card-title">@item.Product.Name</h5>
                    <p class="card-text">@item.Product.Business.Name</p>
                </div>
            </div>


        }

    }
</div>
@code {

    [Parameter]

    public List<UserBusiness>? favoriteBusinesses { get; set; }
    public List<UserBusiness>? lastVisited { get; set; }
    public List<Business>? suggestedBusinesses { get; set; }
    public List<FavoriteProducts>? favoriteProducts { get; set; }


    protected override async Task OnInitializedAsync()
    {
        lastVisited = await _usersServices.GetLastVisitedBusinessesByUserAsync(SignInManager.Context.User.Identity.Name);
        favoriteBusinesses = await _usersServices.GetFavoriteBusinessesByUserAsync(SignInManager.Context.User.Identity.Name);
        suggestedBusinesses = await _businessesServices.GetSuggestedBusinessesAsync();
        favoriteProducts = await _productsServices.GetFavoriteProductsByUserAsync(SignInManager.Context.User.Identity.Name);



    }
}
